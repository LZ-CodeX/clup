import{A as o}from"./api_clusterManage.30301838.js";import{f as e}from"./verificationRules.dffd2894.js";import{n as t}from"./index.73971a8d.js";const i={};var r=t({name:"dbList",components:{},data(){return{clusterState:this.$route.query.cluster_state,rows:[],total:0,page:1,size:20,roomList:[],loading:!1,addFormVisible:!1,addFormRules:{room_name:[{required:!0,message:this.$t("polarDbComputerRoomConfig.qingshuru-jifangmingcheng"),trigger:"blur"}],vip:[{required:!0,message:this.$t("polarDbComputerRoomConfig.qingshuru-VIP"),trigger:"blur"},{required:!0,validator:e,trigger:"blur"}]},addForm:{scores:100},currentRow:"",editFormVisible:!1,editFormRules:{room_name:[{required:!0,message:this.$t("polarDbComputerRoomConfig.qingshuru-jifangmingcheng"),trigger:"blur"}],vip:[{required:!0,message:this.$t("polarDbComputerRoomConfig.qingshuru-VIP"),trigger:"blur"},{required:!0,validator:e,trigger:"blur"}]},editForm:{}}},watch:{"editForm.is_rewind":function(o){o||(this.editForm.is_rebuild=!1)},"editForm.is_rebuild":function(o){o&&(this.editForm.is_rewind=!0)}},methods:{tableRowClassName:({row:o,rowIndex:e})=>e%2!=0?"warning-row":"success-row",showdbList:function(){let e=this;e.loading=!0;let t={cluster_id:e.$route.query.cluster_id};o.getSrClusterRoomInfo(t).then((function(o){e.loading=!1,e.rows=o}),(function(o){e.loading=!1}))},showAddDialog:function(){this.addForm={room_name:"",vip:""},this.addFormVisible=!0},addFormSubmit:function(){let o=this;this.$refs.addForm.validate((e=>{if(e){o.addForm;let e=Object.assign({},this.addForm);e.room_id=Number(o.rows[o.rows.length-1].room_id)+1,o.rows.push(e),o.saveRoomChange()}}))},showEditDialog:function(o,e){const t=this;for(var i in t.editFormVisible=!0,t.currentRow=e,t.editForm=Object.assign({},e),t.editForm)t.editForm[i]=t.editForm[i].toString().trim();t.editForm.index=o},saveRoomChange:function(){const e=this;let t={cluster_id:e.$route.query.cluster_id,room_info:{}};e.loading=!0;for(let o=0;o<e.rows.length;o++)t.room_info[e.rows[o].room_id]={room_name:e.rows[o].room_name,vip:e.rows[o].vip};o.updateSrClusterRoomInfo(t).then((function(o){e.loading=!1,e.addFormVisible=!1,e.editFormVisible=!1,e.showdbList()}),(function(o){e.loading=!1}))},editFormSubmit:function(){let o=this;o.$refs.editForm.validate((e=>{console.log(e),e&&(o.rows.splice(o.editForm.index,1,o.editForm),o.saveRoomChange())}))},deldbList:function(e,t){this.$confirm(this.$t("polarDbComputerRoomConfig.qingqueren-jiangci-message")+t.room_id+this.$t("polarDbComputerRoomConfig.jifang-mingcheng-message")+t.room_name+this.$t("polarDbComputerRoomConfig.yichuma-mewssage"),this.$t("index.ti-shi"),{type:"warning",closeOnClickModal:!1}).then((()=>{const e=this;let i={cluster_id:e.$route.query.cluster_id,room_id:t.room_id};e.loading=!0,o.deleteSrClusterRoomInfo(i).then((function(o){e.loading=!1,e.showdbList()}),(function(o){e.loading=!1}))})).catch((()=>{}))}},mounted:function(){this.showdbList()},destroyed(){clearInterval(this.intervalID)}},(function(){var o=this,e=o.$createElement,t=o._self._c||e;return t("el-row",[t("el-col",[0===o.clusterState||-1===o.clusterState?t("el-button",{staticStyle:{margin:"10px 0"},attrs:{type:"primary"},on:{click:o.showAddDialog}},[o._v(o._s(o.$t("polarDbComputerRoomConfig.zeng-jia")))]):o._e(),t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:o.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"row-class-name":o.tableRowClassName,data:o.rows,border:"","element-loading-text":o.$t("Public.ping-ming-jia-zai-zhong")}},[t("el-table-column",{attrs:{prop:"room_id",label:o.$t("polarDbComputerRoomConfig.jifang-id"),align:"center","min-width":"120px"}}),t("el-table-column",{attrs:{prop:"room_name",label:o.$t("dbList.jifang-mingcheng"),align:"center","min-width":"120px"},scopedSlots:o._u([{key:"default",fn:function(e){return[t("span",{staticClass:"statefont"},[o._v(" "+o._s("默认机房"==e.row.room_name?o.$t("dbList.moren-jifang"):e.row.room_name))])]}}])}),t("el-table-column",{attrs:{prop:"vip",label:"vip",align:"center","min-width":"150px"}}),t("el-table-column",{attrs:{prop:"room_use_state",label:o.$t("polarDbComputerRoomConfig.shiyong-zhuangtai"),align:"center","min-width":"150px"},scopedSlots:o._u([{key:"default",fn:function(e){return[1==e.row.room_use_state?t("i",{staticClass:"el-icon-success green"},[t("span",[o._v(" "+o._s(o.$t("polarDbComputerRoomConfig.yi-shi-yong")))])]):o._e(),0==e.row.room_use_state?t("i",{staticClass:"el-icon-info"},[t("span",[o._v(" "+o._s(o.$t("polarDbComputerRoomConfig.wei-shi-yong")))])]):o._e()]}}])}),t("el-table-column",{attrs:{prop:"handle",label:o.$t("clusterDefine.caozuo"),align:"center","min-width":"150px"},scopedSlots:o._u([{key:"default",fn:function(e){return[0==o.clusterState||-1==o.clusterState?t("span",[t("el-link",{staticClass:"normal",on:{click:function(t){return o.showEditDialog(e.$index,e.row)}}},[o._v(o._s(o.$t("alarmSet.xiugai")))]),1!==e.row.is_primary?t("el-link",{staticClass:"normal",on:{click:function(t){return o.deldbList(e.$index,e.row)}}},[o._v(o._s(o.$t("alarmInformationConfig.yichu")))]):o._e()],1):o._e()]}}])})],1),t("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:o.loading,expression:"loading"}],attrs:{"append-to-body":!0,title:o.$t("polarDbComputerRoomConfig.tianjia-shujuku-shili"),visible:o.addFormVisible,"close-on-click-modal":!1,"element-loading-text":o.$t("Public.ping-ming-jia-zai-zhong")},on:{"update:visible":function(e){o.addFormVisible=e}}},[t("el-form",{ref:"addForm",staticStyle:{width:"90%"},attrs:{model:o.addForm,"label-width":"100px",rules:o.addFormRules}},[t("el-form-item",{attrs:{label:o.$t("dbList.jifang-mingcheng"),prop:"room_name"}},[t("el-input",{attrs:{placeholder:o.$t("polarDbComputerRoomConfig.qingshuru-jifangmingcheng")},model:{value:o.addForm.room_name,callback:function(e){o.$set(o.addForm,"room_name",e)},expression:"addForm.room_name"}})],1),t("el-form-item",{attrs:{label:"vip",prop:"vip"}},[t("el-input",{attrs:{placeholder:o.$t("polarDbComputerRoomConfig.qingshuru-vip")},model:{value:o.addForm.vip,callback:function(e){o.$set(o.addForm,"vip",e)},expression:"addForm.vip"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(e){o.addFormVisible=!1}}},[o._v(o._s(o.$t("index.qu-xiao")))]),t("el-button",{attrs:{type:"primary",loading:o.loading},nativeOn:{click:function(e){return o.addFormSubmit(e)}}},[o._v(o._s(o.$t("defineDatabasePage.ti-jiao")))])],1)],1),t("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:o.loading,expression:"loading"}],attrs:{"append-to-body":!0,title:o.$t("alarmSet.xiugai"),visible:o.editFormVisible,"close-on-click-modal":!1,"element-loading-text":o.$t("Public.ping-ming-jia-zai-zhong")},on:{"update:visible":function(e){o.editFormVisible=e}}},[t("el-form",{ref:"editForm",staticStyle:{width:"90%"},attrs:{model:o.editForm,"label-width":"140px",rules:o.editFormRules}},[t("el-form-item",{attrs:{label:o.$t("dbList.jifang-mingcheng"),prop:"room_name"}},[t("el-input",{attrs:{placeholder:o.$t("polarDbComputerRoomConfig.qingshuru-jifangmingcheng")},model:{value:o.editForm.room_name,callback:function(e){o.$set(o.editForm,"room_name",e)},expression:"editForm.room_name"}})],1),t("el-form-item",{attrs:{label:"vip",prop:"vip"}},[t("el-input",{attrs:{placeholder:o.$t("polarDbComputerRoomConfig.qingshuru-vip")},model:{value:o.editForm.vip,callback:function(e){o.$set(o.editForm,"vip",e)},expression:"editForm.vip"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{nativeOn:{click:function(e){o.editFormVisible=!1}}},[o._v(o._s(o.$t("index.qu-xiao")))]),t("el-button",{attrs:{type:"primary",loading:o.loading},nativeOn:{click:function(e){return o.editFormSubmit(e)}}},[o._v(o._s(o.$t("defineDatabasePage.ti-jiao")))])],1)],1)],1)],1)}),[],!1,n,"0349fb30",null,null);function n(o){for(let e in i)this[e]=i[e]}var a=function(){return r.exports}();export{a as c};
