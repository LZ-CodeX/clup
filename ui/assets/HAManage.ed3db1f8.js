import{n as t,_ as e}from"./index.e6909a03.js";import{A as a}from"./api_clusterManage.333bcab0.js";import"./vendor.194c4086.js";import"./index.dfdb83b1.js";import"./bus.d56574c1.js";const s={};var i=t({name:"HAManage",components:{OperCluster:()=>e((()=>import("./OperCluster.658f534a.js")),["assets/OperCluster.658f534a.js","assets/OperCluster.574ad56d.css","assets/polarDbComputerRoomConfig.260ce1ec.js","assets/taskLog.1080e727.css","assets/api_clusterManage.333bcab0.js","assets/index.dfdb83b1.js","assets/vendor.194c4086.js","assets/bus.d56574c1.js","assets/verificationRules.28629627.js","assets/index.e6909a03.js","assets/index.cbcfa343.css","assets/computerRoomConfig.517d1137.js","assets/computerRoomConfig.4f675eab.css","assets/taskLog.8883e917.js","assets/staticTools.7d79b9f2.js"])},data:()=>({filters:{name:""},total:0,page:1,size:20,loading:!1,rows:[],showMistakeVisible:!1,mistakeContent:"",needToFirstPage:!1}),watch:{"filters.name"(t,e){t!=e&&""!=t&&(this.needToFirstPage=!0)}},methods:{tableRowClassName:({row:t,rowIndex:e})=>e%2!=0?"warning-row":"success-row",handleSizeChange(t){this.size=t,this.needToFirstPage=!0,this.showList()},handleCurrentChange(t){this.page=t,this.showList()},handleSearch(){this.showList()},showList:function(){let t=this;this.needToFirstPage&&(this.page=1),1==this.page&&(this.total=0);let e={page_size:t.size,page_num:t.page};""!==t.filters.name&&(e.filter=t.filters.name),t.loading=!0,a.getClusterList(e).then((function(e){t.loading=!1,t.needToFirstPage=!1,e&&e.rows&&(t.total=e.total,t.rows=e.rows),t.$nextTick((()=>{t.$emit("btnHidden")}))}),(function(e){t.loading=!1}))},showDetailView:function(t,e){let a={page_size:this.size,page_num:this.page,cluster_id:e.cluster_id,cluster_name:e.cluster_name,cluster_type:e.cluster_type,state:e.state};this.$refs.OperCluster.openDialog(a)},onCluter:function(t,e){let s=this,i="";this.$confirm(this.$t("HAManage.queren-jiang-message")+e.cluster_id+this.$t("HAManage.shangxianma"),this.$t("index.ti-shi"),{type:"warning",closeOnClickModal:!1}).then((()=>{s.loading=!0;let t={cluster_id:e.cluster_id};a.online(t).then((function(){s.loading=!1,s.showList()}),(function(t){s.loading=!1,s.$message.closeAll(),s.showMistakeVisible=!0,console.log("err = "+t.response.data);let e=t.response.data;for(let a=0;a<e.length;a++)i+="<p>&#X3000;"+e[a]+"</p>";console.log(e[0]),s.mistakeContent=i}))})).catch((t=>{}))},offCluter:function(t,e){let s=this;this.$confirm(this.$t("HAManage.queren-jiang-message")+e.cluster_id+this.$t("HAManage.lixianma"),this.$t("index.ti-shi"),{type:"warning",closeOnClickModal:!1}).then((()=>{s.loading=!0;let t={cluster_id:e.cluster_id};a.offline(t).then((function(){s.loading=!1,s.showList()}),(function(t){s.loading=!1}))})).catch((()=>{}))},delCluter:function(t,e){let s=this;this.$confirm(this.$t("HAManage.queren-jiang-del-message")+e.cluster_id+this.$t("HAManage.shanchuma"),this.$t("index.ti-shi"),{type:"warning",closeOnClickModal:!1}).then((()=>{s.loading=!0;let t={cluster_id:e.cluster_id};a.delete(t).then((function(){s.loading=!1;let t=Math.ceil((s.total-1)/s.size),e=s.page>t?t:s.page;s.page=e<1?1:e,s.showList()}),(function(t){s.loading=!1}))})).catch((()=>{}))}},mounted:function(){this.showList()}},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-row",{staticClass:"warp"},[a("el-col",{staticClass:"warp-breadcrum",attrs:{span:24}},[a("el-breadcrumb",{attrs:{separator:"/"}},[a("el-breadcrumb-item",[a("span",[t._v(t._s(t.$t("HAManage.HA-guanli")))])])],1)],1),a("el-col",{staticClass:"warp-main",attrs:{span:24}},[a("el-form",{staticClass:"demo-form-inline",staticStyle:{display:"inline-block"},attrs:{inline:!0,model:t.filters},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{staticStyle:{width:"100%"}},[a("el-input",{staticStyle:{width:"400px"},attrs:{placeholder:t.$t("HAManage.qingshuru-jiqun-message")},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleSearch(e)}},model:{value:t.filters.name,callback:function(e){t.$set(t.filters,"name",e)},expression:"filters.name "}},[a("el-button",{attrs:{slot:"append",type:"primary"},on:{click:t.showList},slot:"append"},[t._v(t._s(t.$t("dbList.shou-suo")))])],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:t.$t("Public.question"),placement:"top"}},[a("i",{staticClass:"el-icon-question",staticStyle:{"margin-left":"5px"}})])],1)],1),a("div",{staticStyle:{float:"right","margin-top":"6px"}},[a("el-button",{staticClass:"normal el-icon-refresh-right",staticStyle:{float:"right"},on:{click:t.showList}},[t._v(" "+t._s(t.$t("resourceManagement.shua-xin")))])],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"row-class-name":t.tableRowClassName,data:t.rows,border:"","element-loading-text":t.$t("Public.ping-ming-jia-zai-zhong")}},[a("el-table-column",{attrs:{prop:"display_state",label:t.$t("dbList.zhuang-tai"),"header-align":"center",align:"left",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.state?a("i",{staticClass:"el-icon-success green"},[a("span",{staticClass:"statefont"},[t._v(" "+t._s(e.row.display_state))])]):0===e.row.state?a("i",{staticClass:"el-icon-success"},[a("span",{staticClass:"statefont"},[t._v(" "+t._s(e.row.display_state))])]):-1===e.row.state?a("i",{staticClass:"el-icon-error red"},[a("span",{staticClass:"statefont"},[t._v(" "+t._s(e.row.display_state))])]):4===e.row.state?a("span",{staticClass:"statefont"},[a("i",{staticClass:"el-icon-loading green"}),t._v(" "+t._s(e.row.display_state))]):a("span",{staticClass:"statefont"},[a("i",{staticClass:"el-icon-success red"}),t._v(" Failed")])]}}])}),a("el-table-column",{attrs:{prop:"cluster_id",label:t.$t("dbList.jiqun-id"),align:"center",width:"100px"}}),a("el-table-column",{attrs:{prop:"cluster_type",label:t.$t("HAManage.gaokeyong-leixing"),align:"center",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.cluster_type?a("span",[t._v(" "+t._s(t.$t("HAManage.liufuzhi")))]):2===e.row.cluster_type?a("span",[t._v(" "+t._s(t.$t("HAManage.gongxiang-cipan")))]):11===e.row.cluster_type?a("span",[t._v(" "+t._s(t.$t("HAManage.polardb-gongxiang-cunchu")))]):21===e.row.cluster_type?a("span",[t._v(" "+t._s(t.$t("HAManage.patroni-jiqun")))]):t._e()]}}])}),a("el-table-column",{attrs:{prop:"cluster_name",label:t.$t("resourceManagement.jiqun-mingchen"),align:"center","min-width":"100px","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{prop:"vip",label:"VIP",align:"center","min-width":"130px"}}),a("el-table-column",{attrs:{prop:"handle",label:t.$t("dbList.cao-zuo"),align:"center","min-width":"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-link",{staticClass:"detail",attrs:{size:"mini"},on:{click:function(a){return t.showDetailView(e.$index,e.row)}}},[t._v(t._s(t.$t("BackupPlanManage.xiangqing")))]),21!=e.row.cluster_type?a("span",[a("span",{staticStyle:{color:"rgb(218 220 224)","font-size":"12px"}},[t._v("|")]),1===e.row.state?a("el-link",{staticClass:"offLine",attrs:{size:"mini"},on:{click:function(a){return t.offCluter(e.$index,e.row)}}},[t._v(t._s(t.$t("dashboard.li-xian")))]):0===e.row.state||-1===e.row.state?a("el-link",{staticClass:"onLine",attrs:{size:"mini"},on:{click:function(a){return t.onCluter(e.$index,e.row)}}},[t._v(t._s(t.$t("HAManage.shang-xian")))]):t._e()],1):t._e()]}}])})],1),a("div",{staticClass:"block",staticStyle:{float:"right"}},[a("el-pagination",{ref:"pagination",attrs:{layout:"total, sizes, prev, pager, next, jumper",total:t.total,"page-sizes":[20,30,40,50,100]},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),a("el-dialog",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{"text-align":"left"},attrs:{title:t.$t("HAManage.fasheng-cuowu"),visible:t.showMistakeVisible,"close-on-click-modal":!1,"element-loading-text":t.$t("Public.ping-ming-jia-zai-zhong"),width:"50%"},on:{"update:visible":function(e){t.showMistakeVisible=e}}},[a("el-card",{staticClass:"box-card",attrs:{shadow:"never"}},[a("div",{domProps:{innerHTML:t._s(t.mistakeContent)}})])],1)],1),a("oper-cluster",{ref:"OperCluster",on:{refreshTable:t.showList}})],1)}),[],!1,n,"064ea122",null,null);function n(t){for(let e in s)this[e]=s[e]}var l=function(){return i.exports}();export{l as default};
